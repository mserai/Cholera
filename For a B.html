<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>For a B</title>
</head>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.css">
</head>
<body>
<div class="ui fluid container">
  <div id="table"style="padding-left: 500px; width: 400px"></div>
</div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id="maleBar"> <!--Male fatalities by age--> </div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id="femaleBar"> <!--Female fatalities by age--></div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id = "malePie"></div>
<div id = "femalePie"></div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<script>
  Plotly.d3.tsv("https://raw.githubusercontent.com/mserai/Cholera/master/naplesCholeraAgeSexData.tsv", function(err, rows){
    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }
    var headerNames = Plotly.d3.keys(rows[3]);
    console.log(headerNames);
    var headerData = [];
    var cellData = [];
    for (i = 0; i < headerNames.length; i++) {
      headerValue = [headerNames[i]];
      headerData[i] = headerValue;
      cellValue = unpack(rows, headerNames[i]);
      cellData[i] = cellValue;
    }
    // clean date
    for (i = 0; i < cellData[1].length; i++) {
      var ageValue = cellData[1][i].split(' ')[0];
      cellData[1][i] = ageValue
    }
    var maleValues = cellData[1].slice(0);
    var femaleValues = cellData[2].slice(0);
    console.log(cellData[0]);
    console.log(maleValues);
    console.log(femaleValues);
    var data = [{
      type: 'table',
      columnwidth: [30,30,30,],
      columnorder: [0,1,2],
      header: {
        values: headerData,
        align: "center",
        font: {family: "Helvetica", size: 11, color: "white"},
        line: {color: 'rgb(50, 50, 50)',width: 1, },
        fill: {color: ['green']}
      },
      cells: {
        values: cellData,
        align: "center",
        font: {family: "Helvetica", size: 11, color: ["black"]},
        line: {color: "black", width: 1},
        fill: {color: ['rgb(144, 238, 144)','white']}
      }
    }];
    var maleBarData = [
      {
        x: ["0-1" ,"2-5","6-10","11-14","16-20","21-40","41-60","61-80","over 80"],
        y: [8.2,14,12.1,7.8,7.2,12.1,13.7,20.5,39.6],
        type: 'bar'
      }
    ];
    var femaleBarData = [
      {
        x: ["0-1" ,"2-5","6-10","11-14","16-20","21-40","41-60","61-80","over 80"],
        y: [8.9,14.7,11.2,7.1,7.2,11.8,12.9,20.5,37.8],
        type: 'bar'
      }
    ];
    var malePieData = [{
      values: maleValues,
      labels: cellData[0],
      type: 'pie'
    }];
    var femalePieData = [{
      values: femaleValues,
      labels: cellData[0],
      type: 'pie'
    }];
    var fLayout = {
      title: 'Female',
      height: 400,
      width: 500
    };
    var mLayout = {
      title: 'Male',
      height: 400,
      width: 500
    };
    var layout = {
      title: "Table of Fatalities by Sex and Age group"
    };
    Plotly.plot('table', data, layout);
    Plotly.newPlot('malePie', malePieData, mLayout);
    Plotly.newPlot('femalePie', femalePieData, fLayout);
    Plotly.newPlot('maleBar', maleBarData);
    Plotly.newPlot('femaleBar', femaleBarData);
  });
</script>
</body>