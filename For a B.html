<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>For a B</title>
</head>
<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.css">
</head>
<body>
<div id="table"> <!-- Table --> </div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id="maleBar"> <!--Male fatalities by age--> </div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id="femaleBar"> <!--Female fatalities by age--></div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>
<div id = "malePie"></div>
<div id = "femalePie"></div>
<div>
  <div class="ui fluid container">
    <div style="border-style: solid"></div>
  </div>
</div>

<script>
  Plotly.d3.tsv("https://raw.githubusercontent.com/idemello/Cholera484/master/naplesCholeraAgeSexData.tsv", function(err, rows){
    function unpack(rows, key) {
      return rows.map(function(row) { return row[key]; });
    }
    var headerNames = Plotly.d3.keys(rows[3]);
    console.log(headerNames);
    var headerValues = [];
    var cellValues = [];
    for (i = 0; i < headerNames.length; i++) {
      headerValue = [headerNames[i]];
      headerValues[i] = headerValue;
      cellValue = unpack(rows, headerNames[i]);
      cellValues[i] = cellValue;
    }
    // clean date
    for (i = 0; i < cellValues[1].length; i++) {
      var ageValue = cellValues[1][i].split(' ')[0];
      cellValues[1][i] = ageValue
    }
    var maleValues = cellValues[1].slice(0);
    var femaleValues = cellValues[2].slice(0);
    console.log(cellValues[0]);
    console.log(maleValues);
    console.log(femaleValues);
    var data = [{
      type: 'table',
      columnwidth: [200,500,600,600,400,400,600,600,600],
      columnorder: [0,1,2,3,4,5,6,7,8,9],
      header: {
        values: headerValues,
        align: "center",
        line: {width: 1, color: 'rgb(50, 50, 50)'},
        fill: {color: ['rgb(235, 100, 230)']},
        font: {family: "Arial", size: 11, color: "white"}
      },
      cells: {
        values: cellValues,
        align: ["center", "center"],
        line: {color: "black", width: 1},
        fill: {color: ['rgba(228, 222, 249, 0.65)','rgb(235, 193, 238)', 'rgba(228, 222, 249, 0.65)']},
        font: {family: "Arial", size: 10, color: ["black"]}
      }
    }];
    var maleBarData = [
      {
        x: ["0-1" ,"2-5","6-10","11-14","16-20","21-40","41-60","61-80","over 80"],
        y: [8.2,14,12.1,7.8,7.2,12.1,13.7,20.5,39.6],
        type: 'bar'
      }
    ];
    var femaleBarData = [
      {
        x: ["0-1" ,"2-5","6-10","11-14","16-20","21-40","41-60","61-80","over 80"],
        y: [8.9,14.7,11.2,7.1,7.2,11.8,12.9,20.5,37.8],
        type: 'bar'
      }
    ];
    var malePieData = [{
      values: maleValues,
      labels: cellValues[0],
      type: 'pie'
    }];
    var femalePieData = [{
      values: femaleValues,
      labels: cellValues[0],
      type: 'pie'
    }];
    var fLayout = {
      title: 'Female',
      height: 400,
      width: 500
    };
    var mLayout = {
      title: 'Male',
      height: 400,
      width: 500
    };
    var layout = {
      title: "Bitcoin mining stats for 180 days"
    };
    Plotly.newPlot('malePie', malePieData, mLayout);
    Plotly.newPlot('femalePie', femalePieData, fLayout);
    Plotly.newPlot('maleBar', maleBarData);
    Plotly.newPlot('femaleBar', femaleBarData);
    Plotly.plot('table', data);
  });
</script>
</body>