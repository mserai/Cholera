<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>For an A</title>
  <head>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.2/semantic.min.css">
  </head>
</head><nav class="ui stackable menu">
  <a style="padding-top: 8px; padding-left: 50px;" href="https://mserai.github.io/projects/cholera">About</a>
</nav>
<body>
<div class="ui fluid container">
<div id="map"></div>
</div>
<script>
  /*1. Read in choleraDeathLocations.csv and ...*/
  Plotly.d3.csv('https://raw.githubusercontent.com/mserai/Cholera/master/choleraDeathLocations.csv', function(err, rows){
    Plotly.d3.csv('https://raw.githubusercontent.com/mserai/Cholera/master/choleraPumpLocations.csv', function(err1, rows1) {
      function readAndPull(element, key) {
        return element.map(function (row) { return row[key];
        });
      }
      var pumpY = [];
      var pumpX = [];
      /*Grab*/
      pumpY.push(Object.keys(rows1[0])[0]);
      pumpX.push(Object.keys(rows1[0])[1]);
      for (var i = 0; i < rows1.length; i++) {
        pumpX.push(rows1[i]["51.513341"]);
        pumpY.push(rows1[i]["-0.136668"]);
      }
      for (var i = 0; i <= rows1.length; i++) {
        rows.push({Deaths: "10.0", pumpLong: pumpY[i], pumpLat: pumpX[i]});
      }
      console.log(rows);
      console.log(rows1);
      var colors = [[0, 'rgb(150,0,90)'],[0.1, 'rgb(0, 0, 200)'],[4,'rgb(0, 25, 255)'],[6,'rgb(0, 152, 255)'],[8,'rgb(44, 255, 150)'],[10,'rgb(151, 255, 0)'],[12,'rgb(255, 234, 0)'],[14,'rgb(255, 111, 0)'],[16,'rgb(255, 0, 0)']];

      /*2. Show a map of the locations of the deaths...*/
      var plots = [{
        type: 'scattermapbox',
        mode: 'markers',
        text: readAndPull(rows, 'Deaths'),
        lon: readAndPull(rows, 'pumpLong'),
        lat: readAndPull(rows, 'pumpLat'),
        marker: {
          color: readAndPull(rows, 'Deaths'),
          autocolorscale: false,
          colorscale: colors,
          cmin: 0,
          cmax: 20,
          opacity: 0.7,
          size: readAndPull(rows, 'Deaths'),
          sizeref: 0.3,
          colorbar: {
            thickness: 10,
            titleside: 'right',
            outlinecolor: 'rgba(68,68,68,0)',
            ticks: 'outside',
            ticklen: 3,
            shoticksuffix: 'last',
            ticksuffix: ' deaths',
            dtick: 1
          }
        },
        name: 'Pumps with Death Locations'
      }];
      layout = {
        height: 1000,
        width: 2000,
        dragmode: 'zoom',
        title: 'Pumps and Deaths',
        mapbox: {
          center: {
            lat: 51.510413,
            lon: -0.132347
          },
          domain: {
            x: [0, 1],
            y: [0, 1]
          },
          style: 'light',
          zoom: 15.1
        },
        margin: {
          r: 0,
          t: 0,
          b: 0,
          l: 0,
          pad: 0
        },
        showlegend: false
      };
      Plotly.setPlotConfig({
        mapboxAccessToken: 'pk.eyJ1IjoiaWRlbWVsbG8iLCJhIjoiY2ptNnFiZmc5MDJoZzNwdXE2aXhiYXNqdCJ9.qKCVHMu9enwE6uzCJRDgFw'
      });
      /*Go*/
      Plotly.newPlot('map', plots, layout);
    })
  });
</script>
</body>
</html>